# 8장 스프링이란 무엇인가?

## 8.1 스프링의 정의

- 스프링에 대해 가장 잘 알려진 정의는 아래와 같다
    - **자바 엔터프라이즈 개발을 편하게 해주는 오픈소스 경량급 애플리케이션 프레임워크**

### 애플리케이션 프레임워크

- 프레임워크는 애플리케이션의 특정 계층에서 주로 동작하는 한 가지 기술 분야에 집중되지만 스프링은 이와 다르게 애플리케이션 전 영역을 포괄하는 프레임워크
- 즉, **애플리케이션 프레임워크란** **특정 계층이나, 기술, 업무 분야에 국한되지 않고 애플리케이션의 전 영역을 포괄하는 범용적인 프레임워크**를 말한다.
- 스프링이 애플리케이션 프레임워크라고 불리는 이유는?
    - 애플리케이션 전 영역을 관통하는 일관된 프로그래밍 모델과 핵심 기술을 바탕으로 각 분야의 특성에 맞는 필요를 채워주고 있어 애플리케이션을 빠르고 효과적으로 개발할 수 있기 때문

### 경량급

- 스프링은 수십만 라인에 달하는 코드를 가진 매우 복잡하고 방대한 규모의 프레임워크인데 스프링이 가볍다고 하는 이유는?
    - 불필요하게 무겁지 않기 때문
        
        →EJB는 고가의 느리고 무거운 자바 서버가 필요했고, 다루기 힘든 난해한 설정파일 구조 등 개발하기 힘든 반면, 스프링은 단순한 서버 환경인 톰캣에서도 완벽하게 동작하고,단순한 개발툴과 기본적인 개발환경으로도 엔터프라이즈 개발에서 필요로 하는 주요한 기능을 갖춘 애플리케이션을 개발하기 충분하기 때문
        
- 만들어진 코드가 지원하는 기술 수준은 비슷해도 그것을 훨씬 빠르고 간편하게 작성하게 해줌으로써 생산성과 품질 면에서 유리하다는 것이 바로 경량급이라는 말로 설명되는 스프링의 특징

### 자바 엔터프라이즈 개발을 편하게

- 스프링이라는 프레임워크가 제공해주는 기술이 아니라 자신이 작성하는 애플리케이션 로직에 관심을 집중하게 해주는 것
- 즉, 트랜잭션, 커넥션 풀 등 기술적인 부분이 아닌 비즈니스 로직에만 집중할 수 있게 해주는 것을 말한다.

### 오픈 소스

- 소스가 모두에게 공개되고, 특별한 라이선스를 취득할 필요 없이 얼마든지 가져다 자유롭게 이용해도 된다는 뜻
- 장점
    - 다양한 환경에서 일하는 개발자가 자신이 경험한 문제나 버그를 커뮤니티를 통해 개발팀에 전달해서 잠재적인 버그와 문제점을 빠르게 발견하고 해결 가능
    - 라이선스 비용에 대한 부담이 없다는 점
- 단점
    - 지속적이고 안정적인 개발이 계속될지가 불확실하다는 것 → 이런 문제를 스프링은 스프링의 지속적인 개발을 위해 정규 업무시간에 풀타임으로 오픈소스 개발에 전념할 수 있게 함

<br>

## 8.2 스프링의 목적

- **경량급 프레임워크인 스프링을 활용해서 엔터프라이즈 애플리케이션 개발을 편하게 하는 것**
- **엔터프라이즈 애플리케이션 개발이 왜 편하지 않은걸까?**
    - 앤터프라이즈 시스템 개발이 너무 복잡해져서이기 때문
        - 엔터프라이즈 시스템 : 서버에서 동작하며 기업과 조직의 업무를 처리해주는 시스템
- **복잡함의 근본적인 이유**
    1. 기술적인 제약조건과 요구사항이 늘어가기 때문
        - 순수한 비즈니스 로직을 구현하는 것 외에도 보안,안정성, 확장성 등 기술적으로 고려할 사항이 점점 많아짐
    2. 앤터프라이즈 애플리케이션이 구현해야 할 핵심기능인 비즈니스 로직의 복잡함이 증가하기 때문
        - 기능 요구사항과 업무 정책 등이 바뀌기 때문에 애플리케이션을 자주 수정해줘야 하는 시대가 되었고, 이전과 다르게 시스템 개발과 유지보수, 추가 개발 등의 작업에 대한 부담은 커지고 그에 따른 개발의 난이도는 더욱 증가한 것

- **복잡함을 가중시키는 원인**
    1. 비즈니스 로직의 복잡함
    2. 기술적인 복잡함
    - 복잡하다는 것 → 양이 많고 어렵다는 뜻이 아니라, 세부 요소가 이해하기 힘든 방식으로 얽혀 있고, 그 때문에 쉽게 다루기 어렵다는 의미
    - 이렇게 성격이 다른 복잡한 비즈니스 로직과 기술적인 코드가 섞이기 때문에 복잡함을 가중시켰다.

- 제거될 수 없는 근본적인 복잡함
    - 비즈니스 로직의 복잡함과 기술적인 복잡함을 효과적으로 상대할 수있는 전략과 기법이 필요 → 두 가지 복잡함이 한 군데 어우러져 나타나는 방식은 복잡함을 효과적으로 다루기가 힘듦
    - 따라서 비즈니스 로직의 복잡함과 기술적인 복잡함을 분리해내는 것이 중요하다

- **실패한 해결책 : EJB**
    - 로우레벨의 기술적인 복잡함과 비즈니스 로직의 복잡함을 분리하여 개발자가 로우레벨의 기술적인 복잡함을 신경쓰지 않고, 비즈니스 로직을 효과적으로 개발하는데 집중할 수 있게 하자는 목표가 존재함
    - 하지만, 이런 목표를 이루는데 실패했는데 그 이유는 다음과 같음
        - 기술에 종속적(침투적)이라는 문제 때문
        - EJB환경에서 동작하기 위해 특정 인터페이스를 구현하고, 특정 클래스를 상속하는 등 환경과 스펙에 종속되는 코드로 만들어져 자바 언어의 특징인 객체지향적인 특성을 잃어버렸기 때문
        
- **비침투적인 방식을 통한 효과적인 해결책 : 스프링**
    - 기술적인 복잡함을 애플리케이션 핵심 로직의 복잡함으로부터 제거(분리)하려는 목표를 둠
    - 비침투적 전략을 선택했기 때문에 성공(스프링이 애플리케이션 코드에 불필요하게 나타나지 않도록 함)

- **복잡함을 상대하는 스프링의 전략**
    - 기술적 복잡함을 상대하는 전략
        1. 기술에 대한 접근 방식이 일관성이 없고, 특정 환경에 종속적이다
            - 동일한 목적으로 만들어졌지만 구현체마다 사용방법도 다르고 접근 방식이 다른 경우
                
                → **서비스 추상화**를 통해 로우레벨의 기술 구현 부분과 기술을 사용하는 인터페이스를 분리하고, 환경에 독립적인 인터페이스를 제공하는 방법
                
        2. 기술적인 처리를 담당하는 코드가 성격이 다른 코드에 섞여서 등장한다
            - 책임에 따라 계층을 구분하고 최대한 성격이 다른 코드를 분리해도 기술적인 로직과 비즈니스 로직이 얽혀 있음 → **AOP**를 이용하여 비즈니스 로직과 기술 관련 코드를 별도의 모듈로 분리하는 방법 s
    - 비즈니스와 애플리케이션 로직의 복잡함을 상대하는 전략
        1. 객체 지향과 DI
            - 객체지향과 DI를 이용해 유연하고 확장성이 좋은 설계로 이끌어줌

<br>

## 8.3 POJO 프로그래밍

- POJO에 애플리케이션의 핵심 로직과 기능을 담아 설계하고 개발하는 방법
- 스프링의 목적은 애플리케이션 개발의 복잡함을 줄여주는 것 또는 효과적으로 대응하게 해주는 것
- 하지만 좀 추상적임 → 스프링의 정수는 엔터프라이즈 서비스 기능을 POJO에 제공하는 것
    - = 엔트프라이즈 서버스 기술과 POJO라는 애플리케이션 로직을 담은 코드를 분리했다는 뜻
    - 엔터프라이즈 서비스 : 보안, 트랜잭션과 같은 엔터프라이즈 시스템에서 요구되는 기술

![스크린샷 2023-11-06 오후 8 43 54](https://github.com/HoChangSUNG/mentoring/assets/76422685/699b2aa6-a7c5-4ab6-847a-79f5a696f883)

- 스프링 애플리케이션은 POJO를 이용해 만든 애플리케이션 코드와 POJO가 어떻게 관계를 맺고 동작하는지를 정의해놓은 설계정보로 구분
- DI의 기본 아이디어 → 유연하게 확장 가능한 오브젝트를 만들어두고 그 관계는 외부에서 다이내믹하게 설정해준다는 것
- DI의 개념을 애플리케이션 전반에 걸쳐 적용하는 것이 스프링의 프로그래밍 모델
- IoC/DI, AOP, PSA는 애플리케이션을 POJO로 개발할 수 있게 해주는 **가능기술**이라 불림

**POJO**(Plain Old Java Object)

- **객체지향적인 원리에 충실하면서, 환경과 기술에 종속되지 않고 필요에 따라 재활용될 수 있는 방식으로 설계된 오브젝트**
- POJO 조건
    1. 특정 규약에 종속되지 않는다
        - 특정 규약을 따라 만들게 하는 경우 대부분 규약에서 제시하는 특정 클래스를 상속하도록 요구하는데, 이럴 경우 자바의 단일 상속 제한 때문에 클래스에 객체지향적인 설계 기법을 적용하기 어려워지는 문제가 생김
    2. 특정 환경에 종속되지 않는다
        - 특히 비즈니스 로직을 담고 있는 POJO 클래스는 웹이라는 환경정보나 웹 기술을 담고 있는 클래스나 인터페이스를 사용하면 안됨 → 웹 외의 클라이언트가 클래스를 사용하지 못하게 되고 웹 서버에 올리지 않고 독립적인 테스트가 힘들어짐
    3. 객체 지향적인 원리에 충실해야 한다
        - 특정 규약과 환경에 종속되지 않는다고 해도, 책임과 역할이 각기 다른 코드를 한 클래스에 몰아 넣고, 강한 결합이 만들어지는 경우, 상속과 다형성의 적용으로 처리하면 깔끔하지만 if/switch문을 사용하는 등 객체 지향적이지 않은 코드를 작성하지 않는다면 POJO라고 부르기 힘들다.

- 장점
    - 특정한 기술과 환경에 종속되지 않는 오브젝트는 그만큼 깔끔한 코드가 될 수 있음
    - POJO로 개발된 코드는 자동화된 테스트에 매우 유리하다.
        - 어떤 환경에도 종속되지 않은 POJO 코드는 매우 유연한 방식으로 원하는 레벨에서 코드를 빠르고 명확하게 테스트할 수 있따
    - 객체지향적인 설계를 자유롭게 적용할 수 있다는 것

### POJO프로그래밍

- POJO 프로그래밍이 가능하도록 기술적인 기반을 제공하는 프레임워크
- 대표적인 예시로는 스프링 프레임워크와 하이버네이트
- 스프링은 엔터프라이즈 애플리케이션 개발의 모든 영역과 계층에서 POJO방식의 구현이 가능하게 하려는 목적으로 만들어짐
- 스프링을 이용하면 POJO 프로그래밍의 장점을 그대로 살려 엔터프라이즈 애플리케이션의 핵심 로직을 객체지향적인 POJO를 기반으로 깔끔하게 구현하고, 엔터프라이즈 환경의 각종 서비스와 기술적인 필요를 POJO방식으로 만들어진 코드에 적용할 수 있음
- 스프링은 비즈니스 로직의 복잡함과 앤터프라이즈 기술의 복잡함을 분리해서 구성할 수있도록 도와주고, 스프링 자신은 기술영역에만 관여하지 비즈니스 로직을 담당하는 POJO에서는 모습을 감춘다.


<br>

## 8.4 스프링의 기술

- POJO 프로그래밍을 손쉽게 할 수 있도록 지원하는 세 가지 가능기술인 **IoC/DI, AOP, PSA**이다.
- 스프링의 기술들은 스프링 프레임워크가 만들어진 진정한 목표인 POJO 기반의 엔터프라이즈 개발을 편리하게 해주는 도구일 뿐임

### IoC/DI

- 왜 오브젝트를 분리하고, 인터페이스를 두고 느슨하게 연결한 뒤, 실제 사용할 대상은 DI를 통해 외부에서 지정하는 것일까?
    
    = 직접 자신이 사용할 오브젝트를 new 키워드로 생성해서 사용하는 강한 결합을 쓰는 방법보다 나은 점은 무엇일까?
    
    - 유연한 확장이 가능하게 하기 위해서이다.
        - 유연한 확장이라는 장점 → OCP의 확장에는 열려있고,변경에는 닫혀 있다.
        - 예시
            - A → B 의존관계를 가진다면, B가 변경되도 A는 아무런 영향을 받지 않음 → B 관점에서는 유연한 확장 A관점에서는 변경 없이 재사용이 가능
- DI의 활용 방법
    1. 핵심기능의 변경
        - 의존 대상의 구현을 바꿈
        - 디자인 패턴의 전략 패턴이 대표적인 예
    2. 핵심기능의 동적인 변경
        - 의존 오브젝트의 핵심기능 자체를 바꾸는 것
        - 일반적인 DI를 이용한 변경 방법과 달리 동적(애플리케이션 도작 중간에)으로 매번 다르게 변경할 수 있음
        - 사용자의 등급에 따라 다른 DataSource를 사용하게 만들 수 있음
    3. 부가기능의 추가
        - 핵심 기능은 그대로 두고 부가 기능을 추가(DI덕분)
        - 데코레이터 패턴을 사용
            
            → 인터페이스를 두고 사용하게 하고, 실제 사용할 오브젝트는 외부에서 주입하는 DI를 적용해두면 데코레이터 패턴을 쉽게 적용
            
            → 핵심 기능과 클라이언트 코드에는 영향을 주지 않으면서 부가적인 기능을 추가 가능
            
        - 트랜잭션 기능이 대표적인 예
    4. 인터페이스의 변경
        - 어댑터처럼, 인터페이스가 다른 오브젝트를 클라이언트가 사용하는 인터페이스로 바궈주는 기능을 제공
            
            인터페이스가 일치하지 않는 호출이 필요한 경우 DI유용
            
        - 위를 일반화해서 PSA는 클라이언트가 일관성 있게 사용할 수 있는 인터페이스를 정의해주고 DI를 통해 어댑터 역할을 하는 오브젝트를 이용하게 함
            
            이를 통해 다른 인터페이스를 가진 로우레벨의 기술을 변경하거나 확장해가면서 사용 가능
            
    5. 프록시
        - 지연된 로딩(lazy loading)에 사용
            - 지연된 로딩 : 필요한 시점에서 실제 사용할 오브젝트를 초기화하고 리소스를 준비하게 해줌
        - 원격 프록시에 사용
            - 원격 오브젝트를 호출할 때 마치 로컬에 존재하는 오브젝트처럼 사용할 수 있게 해줌
    6. 템플릿과 콜백
        - 반복적으로 등장하는 고정적인 작업 흐름과 자주 바뀌는 부분을 분리해서 템플릿과 콜백으로 만들어 DI원리를 적용
        - 콜백을 템플릿에 주입하는 방식으로 동작하게 하는 것이 DI의 원리에 가장 충실한 응용 방법
        - 콜백을 얼마든지 만들어서 사용하는 건 개방을 통해 유연한 확장성을 보여주는 것이고, 템플릿은 한 번 만들어두면 계속 재사용할 수 있다는 건 기능의 확장에도 변하지 않는다는 OCP에 들어맞음
    7. 싱글톤과 오브젝트 스코프
        - DI가 필요한 이유 중 하나 → DI할 오브젝트의 생명주기를 제어할 수있다는 점
        - 컨테이너가 오브젝트를 제어하기 때문에 오브젝트의 스코프를 자유롭게 제어가 가능(오브젝트 생성, 관계설정, 이용, 소멸 등 컨테이너가 제어해서)
        - 싱글톤
            - 전통적인 싱글톤 패턴은 오브젝트에 많은 제약을 가해서 권장X
            - 컨테이너가 오브젝트를 관리하는 IoC방식이 유효
                - 컨테이너가 알아서 싱글톤을 만들고 관리하기 때문에 클래스 자체는 싱글톤을 고려하지 않고 자유롭게 설계해도 된다는 장점이 있음
        - 이렇게 오브젝트 스코프를 제어하는 방법 또한 DI를 적용했기 때문
    8. 테스트
        - 테스트를 위해서는 협력 오브젝트로부터 테스트 대상 오브젝트를 고립시켜야 하는데, 이때 테스트할 대상이 의존하는 오브젝트를 테스트 더블로 대체해야 함
        - 테스트 더블로 쉽게 협력 오브젝트를 대체하기 위해서는 DI를 활용해야 하고, OCP를 잘 지켜야 함.

### 애스팩트 지향 프로그래밍(AOP)

- 객체지향 기술은애플리케이션의 요구조건과 기술적인 난해함을 모두 해결하는데 한계가 존재
- 따라서 이러한 객체지향 기술의 한계와 단점을 극복하도록 도와주는 보조적인 프로그래밍 기술이 AOP
- 스프링의 목적인, POJO만으로 앤터프라이즈 애플리케이션을 개발하면서도 엔터프라이즈 서비스를 선언적으로 제공하는 데 반드시 필요한 것이 AOP 기술
- 적용 기법
    1. 스프링과 같이 다이나믹 프록시를 사용하는 방법
        - 기존 코드에 영향을 주지 않고 부가기능을 적용하게 해주는 데코레이터 패턴을 응용
        - 부가기능을 부여할 수 있는 곳은 메소드의 호출이 일어나는 지점뿐이라는 제약이 존재
        - 스프링의 기본적인 AOP 구현 방법은 다이나믹 프록시를 이용하는 프록시 AOP 방식
    2. 자바 언어의 한계를 넘어서는 언어의 확장을 이용하는 방법
        - AspectJ와 같이 별도의 AOP컴파일러를 이용해 빌드하거나, 클래스가 메모리에 로딩될 때 바이트 코드를 조작하는 위빙과 같은 별도의 방법을 이용
        - 자바 언어와 JDK의 지원만으로는 불가능
        - 다양한 조인 포인트 제공
            - 메소드 호출 지점, 인스턴스 생성, 필드 엑세스 등 위치에 부가기능 제공 가능

### 포터블 서비스 추상화(PSA)

- 환경과 세부 기술의 변화에 관계없이 일관된 방식으로 기술에 접근할 수 있게 해줌
    - 특정 환경과 기술에 종속적이지 않다는 게 그런 기술을 사용하지 않는다는 뜻이 아니라 POJO 코드가 그런 기술에 직접 노출되어 만들어지지 않는다는 뜻
- PSA를 위해 스프링에서는 서비스 추상화 기술을 제공
    
    이처럼 스프링은 앤터프라이즈 개발에 사용되는 다양한 기술에 대해 서비스 추상화 기술을 제공
    
- 서비스 추상화를 위해서는 DI 기술만 필요 → DI를 적극 활용한다면 서비스 추상화는 자연스럽게 만들어 쓸 수 있ㅇㅁ
- 서비스 추상화 → 구체적인 기술에 종속되지 않게 하기 위해 + 테스트가 어렵게 만들어진 API나 설정을 통해 주요 기능을 외부에서 제어하게 만들고 싶을 때 사용

<br>

## 정리

- 스프링은 오픈 소스 소프트웨어, 애플리케이션 개발의 모든 기술과 영역을 종합적으로 다루는 애플리케이션 프레임워크다.
- 앤터프라이즈 애플리케이션 개발의 복잡함은 비즈니스 로직과 앤터프라이즈 시스템의 기술적인 요구에 의해 발생
    
    기존의 접근법은 이 복잡도를 낮추지 못하며 자바의 객체지향적인 장점을 포기해야 한다는 문제점이 존재
    
- 자바의 근본인 객체지향적인 원리에 충실하게 개발할 수 있으며, 환경과 규약에 의존적이지 않은 POJO를 이용한 애플리케이션 개발은 앤터프라이즈 시스템 개발의 복잡함이 주는 많은 문제를 해결할 수 있다.
- 스프링의 목적은 이런 POJO를 이용해 엔터프라이즈 애플리케이션을 쉽고 효과적으로 개발할 수 있도록 지원해주는 데 있다.
- POJO방식의 개발을 돕기 위해 스프링은 IoC/DI, AOP, PSA와 같은 가능기술을 프레임워크와 컨테이너라는 방식을 통해 제공
