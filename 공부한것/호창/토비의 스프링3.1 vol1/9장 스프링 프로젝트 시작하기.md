# 9장 스프링 프로젝트 시작하기

### 계층형 아키텍처

- 아키텍처 차원에서 책임과 성격이 다른 것을 크게 그룹으로 만들어 분리해두는 것
    
    = 멀티 티어 아키텍처
    
- 보통 웹 기반 엔터프라이즈 애플리케이션은 일반적으로 세개의 계층을 가져 3계층 애플리케이션이라고도 불림

<br>

### 3계층 아키텍쳐와 수직 계층

- 3계층 아키텍처는 데이터 엑세스, 서비스, 프레젠테이션 계층으로 구분
1. 데이터 엑세스 계층
    - DB나 레거시 시스템과 연동하는 인터페이스 역할
    - 사용 기술에 따라 세분화된 계층으로 구분 가능
        - 추상화 수준에 따라 구분하기 때문에 수직적인 계층이라 부르기도 함
            
            <img width="571" alt="스크린샷 2023-11-14 오전 12 25 34" src="https://github.com/HoChangSUNG/mentoring/assets/76422685/d5a1c049-cd0d-436e-9b1f-5e493ae2b32f">

            - JdbcTemplate을 사용하는 데이터 엑세스 계층의 특징
                - JdbcTemplate이 추상화를 위한 계층으로 사용되어 로우 레벨의 기반 계층에 존재하는 JDBC와 드라이버, 스프링 트랜잭션 추상화 서비스의 동기화 기능을 간접적으로 이용하게 만든다는 것
2. 서비스 계층
    - 비즈니스 로직을 담고 있음
    - 잘 만들어진 스프링 애플리케이션의 서비스 계층 클래스는 이상적인 POJO로 작성됨
        
        → POJO로 만든다면 객체지향저 설계 기법이 적용된 코드를 통해 비즈니스 로직의 핵심을 잘 담아내고 이를 쉽게 테스트하고 유연하게 확장 가능
        
    - 서비스 계층은 특별한 경우가 아니라면 추상화 수직 계층구조를 가질 필요가 없음
        
        → 기술 api를 직접 다루는 코드가 아니기 때문에 일관된 방식으로 접근하거나 편하게 사용하게 해주는 추상화가 필요 없기 때문 
        
    - 아래 사진처럼 기반 서비스 계층이 서비스 계층의 오브젝트를 호출하는 경우는 어떤 경우일까?
        
        <img width="562" alt="스크린샷 2023-11-14 오전 12 34 03" src="https://github.com/HoChangSUNG/mentoring/assets/76422685/9a860214-df6b-4202-9821-63343f8ac0d2">

        - 기반 서비스 계층이 서비스 계층의 오브젝트를 호출하는 대표적인 예는 스케쥴링
        
3. 프레젠테이션 계층
    - 웹 기반의 UI를 만들어내고 그 흐름을 관리
    - 매우 다양한 기술과 프레임워크의 조합을 가질 수 있음 → 웹과 프레젠테이션 기술은 끊임없이 발전하고 진보하고 새로운 모델이 등장하기 때문
    - 앤터프라이즈 애플리케이션의 프레젠테이션 계층은 클라이언트의 종류와 상관없이 HTTP 프로토콜을 사용하는 서블릿이 바탕이 됨

<br>

### 계층형 아키텍처 설계의 원칙

- 각 계층은 자신의 계층의 책임에만 충실해야 하고, 응집도가 높으면서 다른 계층과는 낮은 결합도를 유지할 수 있어야 함
- 자신의 역할과 기술에만 충실한 계층을 만들면 각 계층 사이의 결합도는 자연스럽게 낮아짐
    
    계층 간에 사용되는 인터페이스 메소드에서 특정 계층의 기술이 최대한 드러나지 않도록 해야 함
    
    그렇지 않으면, 계층 사이의 결합도가 높아지고, 계층 간 기술이나 역할을 침범
    
    - 예시
        - `public ResultSet findUsersByName(String name)throws SQLException;`
            - 서비스 계층 코드가 ResultSet이라는 데이터 엑세스 계층에서 만들어진 오브젝트를 다뤄 데이터 엑세스 계층 기술에 종속됨
            - SQLException은 특정 데이터 엑세스 계층의 구현에 종속되어 강한 결합을 만들고, 데이터 엑세스 계층의 내부 구현이 변화되면 해당 메서드를 사용하는 서비스 계층 코드도 함께 수정해야 함
- 계층의 경계를 넘어갈 때는 반드시 특정 계층에 종속되지 않는 오브젝트 형태로 변환해줘야 함
    - 계층 간 낮은 결합도를 유지하기 위해서
    
<br>
<br>

## 데이터 중심 아키텍처

- 애플리케이션에 흘러다니는 정보를 단순히 값이나 값을 담기 위한 목적의 오브젝트 형태로 취급하는 구조
- 다음과 같이 구분이 가능
    1. db에 무게를 두는 구조
    2. 서비스 계층의 코드에 무게를 두는 구조

### **DB/SQL 중심의 로직 구현 방식**

<img width="1009" alt="스크린샷 2023-11-16 오후 11 39 39" src="https://github.com/HoChangSUNG/mentoring/assets/76422685/647fb42d-92b8-4ed3-b69d-f7ba5dbae50f">

- 하나의 업무 트랜잭션을 모두 담은 서비스 계층 코드와 해당 업무에 특화된 SQL을 담은 하나 또는 여러 개의 DAO 메소드로 구성됨
    
    서비스 계층이 프레젠테이션 계층에 전달하는 결과의 포멧은 보통 DAO의 SQL결과와 같고, 웹페이지 출력 내용과도 1:!로 매핑
    

→ 항상 SQL과 그 결과에 종속되기 때문에 SQL의 변화가 일어나면 같이 변경돼야 한다, 겉으로 보기에는 각 계층이 독립적으로 보이지만, 그 사이를 이동하는 데이터가 일종의 접착제 역할을 해서 강한 결합이 마늘어지게 됨

- 장점 → 처음에는 개발하기 쉬움
- 단점
    - 변화에 매우 취약(각 계층의 코드가 긴밀하게 연결되어 있기 때문)
    - 로직을 SQL과 DB에 많이 담으면 담을수록 점점 확장성이 떨어짐
    - SQL이나 프로시저에 담긴 로직은 테스트하기 힘듦
    
<br>

### 거대한 서비스 계층 방식

<img width="998" alt="스크린샷 2023-11-16 오후 11 46 24" src="https://github.com/HoChangSUNG/mentoring/assets/76422685/fd3df65e-ad4e-47d5-8cf8-c9d4f08d9819">

- DB에는 부하가 걸리지 않도록 저장 프로시저의 사용을 자제하고 복잡한 SQL을 피하면서, 주요 로직은 서비스 계층에서 처리하도록 만든것
- **DB에 많은 로직을 두는 개발 방법**의 단점을 피하면서 애플리케이션 코드의 비중을 높이는 방법
- 상대적으로 단순한 DAO 로직을 사용하고, 비즈니스 로직 대부분을 서비스 계층에 집중하는 방식
- 장점
    - 애플리케이션의 코드에 비즈니스 로직이 담겨있기 때문에 자바 언어의 장점을 활용해 로직을 구현할 수 있고 테스트하기도 수월
- 단점
    - 데이터 엑세스 계층의 SQL은 서비스 계층의 비즈니스 로직의 필요에 따라 만들어지기 쉬워 계층 간의 결합도가 여전히 큼

<br>
<br>

## 오브젝트 중심 아키텍처

- 도메인 모델을 반영하는 오브젝트 구조를 만들어두고 그것을 각 계층 사이에서 정보를 전송하는 데 사용한다는 것이 데이터 중심 아키텍쳐와의 가장 큰 차이점
- 객체지향 분석과 모델링의 결과로 나오는 도메인 모델을 오브젝트 모델로 활용
- 오브젝트를 만들어두고 오브젝트 구조 안에 정보를 담아서 각 계층 사이에 전달하게 만드는 것이 오브젝트 중심 아키텍처
- 계층간 결합도가 낮아짐
    - 예시
        - DAO는 자신이 DB에서 가져와서 도메인 모델 오브젝트에 담아주는 정보가 어떤 업무 트랜잭션에서 어떻게 사용될지는 신경 쓰지 않아도 됨
        - 서비스 계층 또한 DAO에서 어떤 SQL을 사용했는지 몰라도 됨
- 도메인 오브젝트 사용의 장단점
    - 장점
        - 코드의 재사요엉이 높아지고 DAO는 더 작고 효율적으로 만들어질 수 있음
    - 단점
        1. 최적화된 SQL을 매번 만들어 사용하는 경우에 비해 성능면에서 손해를 감수해야 할 수도 있음
        2. 연관된 오브젝트 정보까지 다 조회해서 낭비가 있을 수 있음
            - Lazy loading을 이용해 최소한의 오브젝트 정보만 읽어두고, 연관된 오브젝트가 필요한 경우에 다이나믹하게 DB에서 다시 읽어올 수 있음

### 빈약한 도메인 오브젝트 방식

![스크린샷 2023-11-17 오후 1 34 43](https://github.com/HoChangSUNG/mentoring/assets/76422685/3a764651-ccb0-46de-9d48-894211431781)

- 도메인 오브젝트에 정보만 담겨 있고, 정보를 활용하는 아무런 기능도 갖고 있지 않고(빈약한 오브젝트), 비즈니스 로직이 서비스 계층에 존재하는 방식
- 한계
    - 도메인 오브젝트라는 일관된 오브젝트를 사용해 SQL에 의존적인 데이터 방식보다는 유연하지만, 여전히 서비스 계층에 대부분의 비즈니스 로직이 들어 있어 로직의 재사용성이 떨어지고 중복의 문제가 발생하기 쉬움
    - 하지만, 비즈니스 로직이 복잡하지 않다면 가장 만들기 쉽고 3계층 구조의 특징을 잘 살려서 개발할 수 있는 유용한 아키텍처이다.
    

### 풍성한 도메인 오브젝트 방식

![스크린샷 2023-11-17 오후 1 35 04](https://github.com/HoChangSUNG/mentoring/assets/76422685/8c0701fd-f9f4-40a0-91ac-6f56932c504f)

- 빈약한 도메인 오브젝트 방식의 단점을 극복하고 도메인 오브젝트이 객체지향적인 특징을 잘 사용할 수 있도록 개선한 방식
- 특정 도메인 오브젝트에 종속되는 비즈니스 로직을 서비스 계층의 오브젝트가 아니라 도메인 오브젝트 안으로 넣는 방식
(도메인 오브젝트가 스스로 처리 가능한 기능과 도메인 비즈니스 로직을 갖도록 만듦)
    - 여러 종류의 도메인 오브젝트의 기능을 조합해서 복잡한 비즈니스 로직은 서비스 계층의 오브젝트에 두는 것이 적당함.
- 빈약한 도메인 오브젝트 방식보다 서비스 계층의 코드가 간결, 비즈니스 로직을 이해하기도 쉬움

<br>

### 도메인 계층 방식

![스크린샷 2023-11-17 오후 1 57 59](https://github.com/HoChangSUNG/mentoring/assets/76422685/e260efe4-cf31-4e9f-a735-9e430acd3734)

- 도메인 오브젝트가 하나의 계층을 이루게 하는 방식(도메인 오브젝트가 기존 3계층과 같은 레벨로 격상되어 하나의 계층을 이룸)
- 도메인 오브젝트들이 하나의 독립적인 계층을 이뤄서 서비스 계층과 데이터 엑세스 계층의 사이에 존재하게 하는 것
- 특징
    1. 도메인의 종속적인 비즈니스 로직의 처리는 서비스 계층이 아니라 도메인 계층의 오브젝트 안에서 진행된다는 점
        - 서비스 계층의 도움 없이도 비즈니스 로직의 대부분의 작업을 수행할 수 있음
    2. 도메인 오브젝트가 기존 데이터 엑세스 계층이나 기반 계층의 기능을 직접 활용할 수 있다는 것
        - 도메인 계층의 도메인 오브젝트들은 빈으로 등록되어 있지 않아 DI받을 수 없기 때문에 AOP를 이용해 DI 받을 수 있도록 함
- 도메인 오브젝트를 독립적인 계층으로 만들려고 할 때 고려해야 할 중요한 사항
    
    → 도메인 오브젝트가 도메인 계층을 벗어나서도 사용되게 할지 말지를 결정해야 함
    
    1. 모든 계층에서 도메인 오브젝트를 사용
        - 도메인 오브젝트에 비즈니스 로직을 가지고 있어 프레젠테이션 계층이나 뷰 등에서 사용하면 위험 → 개발 가이드 라인을 만들어두고 이를 강력하게 적용
    2. 도메인 오브젝트가 도메인 계층에서 벗어나지 못하게 하는 것
        - 도메인 계층 밖으로 전달될 때에는 DTO를 이용해 전달

<br>

### DTO와 리포트 쿼리

- 도메인 계층 방식의 경우 도메인 계층을 벗어난 정보를 전달의 목적을 가진 단순 오브젝트인 DTO에 담아 전달하기도 함
- DTO를 반드시 사용해야 하는 경우는 리포트 쿼리가 대표적인 예시
    - 리포트 쿼리 → 리포트를 출력하기 위해 생성하는 쿼리, 보통 여러 테이블에 걸쳐 존재하는 자료를 분석하고 그에 따른 분석/통계 결과를 생성하는 쿼리
    - DB쿼리에 담긴 필드의 내용보다는 합계, 평균과 같은 계산 값이거나 여러 테이블의 필드를 다양한 방식을 조합하여 만들어서 쿼리의 실행 결과를 담을 만한 적절한 도메인 오브젝트를 찾을 수 없음

<br><br>

### 서드파티 프레임워크, 라이브러리 적용

- 표준 기술 이외에도 많이 사용되는 오픈소스 프레임워크, 라이브러리나 상용 제품도 스프링과 함께 사용할 수 있다.
- 이런 기술을 스프링과 함께 사용할 때는 먼저 스프링이 공식적으로 지원하는 기술인지 확인이 필요
- 스프링이 지원하는 기술이라는 무슨 의미일까?
    1. 해당 기술을 스프링의 DI패턴을 따라 사용할 수 있다.
        - 프레임워크나 라이브러리의 핵심 클래스를 빈으로 등록할 수 있게 지원해주는 것
    2. 스프링의 서비스 추상화가 적용됐다
        - 서비스 추상화를 적용하여 비슷한 기능을 제공하는 기술에 대해 일관된 접근 방법을 정의해줌
    3. 스프링이 지지하는 프로그래밍 모델을 적용했다.
        - 예시로는 데이터 엑세스 기술에 대한 일관된 예외 적용 → 서비스 계층의 비즈니스 로직을 담은 코드가 데이터 엑세스 계층의 기술에 종속되지 않도록 해줌
    4. 템플릿/콜백이 지원된다.
- 스프링이 어떤 기술을 지원한다는 것은 스프링이 지지하는 개발철학과 프로그래밍 모델을 따르면서 해당 기술을 사용할 수 있다는 의미
