# chapter1 ~ 2

# 컴퓨터 시스템 개요(chapter1)

### **프로그램 종류**

- 애플리케이션
    - 사용자가 직접 사용
- 미들웨어
    - 여러 가지 애플리케이션이 공통으로 사용되는 처리를 묶어 애플리케이션의 실행을 도와줌
    - 웹서버, 데이터베이스
- OS(운영체제)
    - 하드웨어를 직접 조작, 애플리케이션이나 미들웨어의 실행에 필요한 기능 제공
    - 리눅스, MS 윈도우

### **디바이스 드라이버**

- 디바이스 드라이버를 통해서만 디바이스(외부장치 - 저장 장치, 입력 장치 등)를 조작 가능
- CPU의 커널모드로 동작할 때만 디바이스 드라이버를 통해 외부 장치에 접근 가능
- 시스템 콜을 호출하여 CPU의 커널모드로 변경하고, 디바이스 드라이버를 호출
- **왜 디바이스 드라이버를 통해서만 디바이스를 조작 가능한가?**
    1. 프로세스에서 디바이스를 직접 조작하기 위해서는 개발자가 디바이스의 스펙을 상세하게 알아야 하기 때문
    2. 멀티 프로세스가 동시에 디바이스 조작시 예상치 못한 동작이 발생할 수 있기 때문
- **왜 CPU의 커널모드로 동작할 때만 디바이스 드라이버를 통해 외부 장치에 접근 가능한가?**
    - 버그나 해킹 목적으로 개발자가 프로세스에서 직접 디바이스를 조작하려 시도하면 멀티 프로세스가 동시에 디바이스를 조작하려고 시도하는 상황이 발생

      → 이러한 상황 피하고자 프로세스가 직접 하드웨어에 접근하지 못하도록 하기 위해 커널 모드일때에만 디바이스에 접근할 수 있도록 함


### **커널**

- 커널 모드에서 동작하는 OS의 핵심 부분이 되는 처리를 담당하는 프로그램
- CPU나 메모리 등의 리소스를 관리, 리소스 일부를 프로세스에게 분배해주는 기능을 가짐

### **파일 시스템**

- 저장 장치에 저장된 데이터를 간단하게 접근하고 조작할 수 있도록 하는 프로그램
- 디바이스 드라이버를 통해 저장장치에 접근할 수 있지만 간단히 접근하기 위해 파일 시스템을 통해 저장장치에 접근



![KakaoTalk_20230730_234658997.jpg](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ec32650c-7dc8-401e-9cab-aeb7b6e561fd/KakaoTalk_20230730_234658997.jpg)

# 사용자 모드로 구현되는 기능(chapter2)

**OS**

- 커널 이외에도 사용자 모드로 동작하는 다양한 프로그램으로 구성
    - 사용자 모드로 동작하는 프로그램
        - 라이브러리 형태, 단독 프로그램 형태로 동작하는 것 존재

**시스템 콜**

- 프로세스가 커널이 제공하는 기능(프로세스 생성, 하드웨어 조작 등)을 사용하기 위해 사용자 모드에서 커널 모드로 전환하기 위해 필요한 인터페이스
- 종류
    - 프로세스 생성, 삭제, 메모리 확보, 해제, 프로세스 간 통신(IPC)
    - 네트워크, 파일 시스템 다루기, 파일 다루기(디바이스 접근)
- strace
    - 프로세스가 어떤 시스템 콜을 호출했는지 확인
    - -T 옵션
        - 시스템 콜 처리에 걸린 시간을 마이크로 단위로 측정
- **시스템 콜 wrapper 함수**

  ![KakaoTalk_20230731_133325240.jpg](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/0353987c-9c07-427f-83aa-37a0c1c6e3b0/KakaoTalk_20230731_133325240.jpg)

    - OS 내부적으로 시스템 콜을 호출할 수 있게 제공해주는 함수
    - 왜 **시스템 콜 wrapper 함수를 사용하는가?**
        - 시스템 콜을 고급 언어에서 직접 호출하지 못하고 어셈블리 코드를 사용해 호출해야 하는 문제를 해결하기 위해 사용


### **CPU 모드 변경**

1. 프로세스가 시스템 콜을 호출
2. CPU에서 인터럽트 이벤트 발생 → CPU는 사용자모드에서 커널 모드로 변경
3. 커널 동작
    1. 프로세스가 요청한 내용 처리하기 전에 프로세스 요구가 유효한지 확인

       (메모리 용량 이상의 메모리 요구 등)

    2. 요구사항이 맞지 않으면 커널이 시스템 콜 실패했다고 처리
4. 요청한 처리가 종료되면 시스템 콜 처리 종료
5. 커널모드에서 사용자 모드로 변경 후 프로세스 동작

### **sar 명령어**

- **프로세스가 사용자 모드와 커널 모드 중 어느 쪽에서 실행되고 있는지 비율** 보여줌

  ![KakaoTalk_20230731_133325240_01.jpg](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6792cc3a-1997-4737-b20c-3fc0a72acb1b/KakaoTalk_20230731_133325240_01.jpg)

- 사용자 모드에서 프로세스를 실행하고 있는 시간 비율
    - %user와 %nice의 합계
- 커널 모드에서 실행하고 있는 시간 비율
    - %system
- ※ %system의 수치가 클 경우
    - 시스템 콜이 너무 많이 호출되거나
    - 시스템에 과부하가 걸려 있는 등 좋지 않은 상태
- **%user와 %nice의 차이**