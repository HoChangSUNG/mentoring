# CHAPTER3 JSP로 시작하는 웹 프로그래밍

## JSP 페이지 구성 요소

- **디렉티브**
    - JSP 페이지에 대한 설정 정보를 지정할 때 사용
    - 예시
        - `<%@ 디렉티브이름 속성1=”값1” 속성2=”값2”…%>`
        - `<%@ page contentType=”text/html; charset=utf-8” %>`
            - 디렉티브 이름 : page
            - 속성 : contentType
            - 속성값 : text/html; charset=utf-8
    - 디렉티브 종류
        - page : JSP 페이지에 대한 정보를 지정
        - taglib : JSP 페이지에서 사용할 태그 라이브러리 지정
        - include : JSP 페이지의 특정 영역에 다른 문서를 포함

- **스크립트 요소** : 스크립트릿, 표현식(Expression), 선언부(Declaration)
    - JSP에서 문서의 내용을 동적으로 생성하기 위해 사용되는 것
        - 스크립트릿 : 자바 코드를 실행할 때 사용하는 코드 블록
        - 표현식(Expression) : 어떤 값을 출력 결과에 포함시키고 싶을 때 사용
        - 선언부(Declaration) : 스크립트릿이나 표현식에서 사용할 수 있는 메소드를 작성할 때 사용

- **표현 언어**
    - JSP 스크립트 요소는 자바 문법을 그대로 사용한다는 특징이 있지만 코드가 다소 복잡해진다는 문제가 존재
    - 표현 언어는 이러한 문제를 해결하기 위해 사용

- **기본 객체**
    - 웹 어플리케이션 프로그래밍을 하는데 필요한 기능을 제공해주는 객체들
    - request, session, response 기본 객체를 주로 사용
- **정적인 데이터**
- **표준 액션 태그, 커스텀 태그와 표준 태그 라이브러리(JSTL)**
    - 태그 형태로 특별한 기능을 제공
    - **커스텀 태그**는 jsp 코드에서 중복되는 것을 모듈화하여 복잡함을 줄이기 위해 사용
    - **JSTL**은 커스텀 태그 중 자주 사용하는 것들을 표준화 한 태그 라이브러리

## page 디렉티브

- JSP 페이지에 대한 정보를 입력하기 위해 사용
- 다음과 같은 속성들이 존재
    - contentType : jsp가 생성할 문서의 MIME 타입과 캐릭터 셋 인코딩을 지정
    - import : JSP 페이지에서 사용할 자바 클래스 지정
    - session : JSP 페이지가 세션을 사용할지 여부 지정
    - 등

- **contentType 속성**
    - jsp가 생성할 문서의 MIME 타입과 캐릭터 셋 인코딩을 지정
    - 주로 `text/html MIME` 타입 사용, 디폴트 값은 `text/html`
    - 그 외에도 `application/json`, `text/xml` 등 존재
    - 예시
        - `<%@ page contentType=”text/html; charset=utf-8”%>`
    - **Mime이란?**
        - 이메일의 내용을 설명하기 위해 정의되었지만 HTTP등 프로토콜에서도 응답 데이터의 내용을 설명하기 위해 사용
    - **글자가 깨져 보이는 이유??**
        - 소스 코드를 저장할 때 사용한 캐릭터 인코딩과 page 디렉티브의 contentType속성에 지정한 캐릭터 셋이 일치하지 않기 때문

- **import 속성**
    - 자바 클래스의 완전한 이름 대신 단순 이름을 사용하기 위해 import 속성 사용
        - `<%@ page import="java.util.Date"%>` → 단순 이름인 Date로 사용 가능
    - page 디렉티브가 없어도 자바 클래스의 완전한 이름을 사용하면 JSP에서 사용가능하지만,
        - 단순 이름 : 패키지 이름을 제외한 나머지 부분
        - 완전한 이름 : 패키지 이름을 포함하여 나타낸 클래스 이름
            - `java.util.Date` → `java.util.Date`는 완전한 이름, `Date`는 단순 이름


## 스크립트 요소

- JSP에서 문서의 내용을 동적으로 생성하기 위해 사용되는 것
    - 스크립트릿 : 자바 코드를 실행할 때 사용하는 코드 블록
        - `<% %>`로 구성
        - `<% 자바코드; %>` 사이에 실행할 자바 코드 위치
    - 표현식(Expression) : 어떤 값을 출력 결과에 포함시키고 싶을 때 사용
        - `<%= 값 %>` 으로 표현
        - `<%= sum %>`
    - 선언부(Declaration) : 스크립트릿이나 표현식에서 사용할 수 있는 메소드를 작성할 때 사용
        - `<%! 메소드 %>`

        ```java
        <%! 
        	public void hello(){
        		return 1;
        	}
         %>
        ```



# 기본 객체

### **Request 기본 객체**

- 웹 브라우저가 웹 서버에게 전송한 요청 정보를 담고 있는 객체
- 기능
    - 클라이언트가 전송한 정보와 서버 정보를 구할 수 있는 기능 지원
    - 웹 브라우저가 전송한 파라미터를 읽어올 수 있는 기능 지원
        - `getParameter(String name)`, `getparameterNames()` 등
    - 헤더 정보를 읽어올 수 있는 기능 지원

- **파라미터를 전송하는 2가지 방법(GET메소드, POST메소드)의 차이**
    - **GET메소드**
        - 쿼리 스트링(문자열) 방식으로 URL뒤에 파라미터를 붙여 전송
        - 웹브라우저, 웹서버에 따라 전송할 수 있는 **파라미터 값의 길이 제한이 있을 수 있음**
            - **쿼리 스트링:** URL 뒤에 ?와 함께 파라미터를 붙여 전송하는 방법
                - `www.naver.com/search?name=sdfsdf`
    - **POST메소드**
        - HTTP 메시지 바디에 파리미터를 저장하여 전송
        - 메시지 바디에 데이터를 저장하여 전송하기 때문에 웹 브라우저나 웹서버에 상관없이 전송할 수 있는 **파라미터  값의 길이 제한이 없음**

- **요청 파라미터 인코딩**
    - 웹브라우저가 웹서버에 파라미터를 전송할 때 ****알맞은 캐릭터 셋을 이용해 **파라미터를 인코딩**
    - 웹서버는 알맞은 캐릭터 셋을 이용해 **인코딩된 파라미터 데이터를 디코딩**
    - **GET,POST 메소드에 따라 인코딩,디코딩에 사용하는 캐릭터 셋이 다름**
        - **POST 메소드**
            - **파라미터 인코딩** : 입력 폼을 보여주는 응답 화면이 사용하는 캐릭터 셋 사용
            - **파라미터 디코딩** : `request.setCharacterEncoding(”utf-8”)`을 통해 파라미터 디코딩할 캐릭터 셋 설정
            - 예시
                - 입력폼의 page 디렉티브 **contentType 속성이 `text/html; charset=”utf-8”`**이고, **`request.setCharacterEncoding(”utf-8”)`인 경우**
                    - 인코딩 : content 속성의 charset이 utf-8이므로 utf-8로 인코딩
                    - 디코딩 : `request.setCharacterEncoding(**”utf-8”**)`의 매개변수가 utf-8이므로 utf-8로 디코딩
        - **GET 메소드**
            - **파라미터 인코딩 규칙**

              ![KakaoTalk_20230729_204923042.jpg](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8b6f3309-9aa1-42d0-ad8f-a536969ad264/KakaoTalk_20230729_204923042.jpg)

                - a 태그를 이용한 방법과 HTML FORM을 이용한 방법은 웹페이지의 캐릭터 셋을 이용하여 파라미터를 인코딩
                - 웹 브라우저에 URL입력하는 방법은 웹 브라우저마다 인코딩할 때 사용할 캐릭터 셋이 다름
                    - 크롬은 UTF-8로 인코딩
                    - 왜 브라우저마다 인코딩할 때 사용할 캐릭터 셋이 다를까?
                        - HTTP 표준에 GET방식으로 전달되는 **파라미터 값을 인코딩할 때 어떤 캐릭터 셋을 사용해야 하는지 표준 규칙이 없기 때문**
            - **파라미터 디코딩 규칙**
                - WAS마다 디코딩할 때 사용하는 캐릭터 셋이 다름
                - `**request.setCharacterEncoding()` 사용 불가능**
                    - 왜 그럴까?
                        - 서블릿 규약에 따르면 request.setCharacterEncoding() 은 http 프로토콜 메시지 바디의 데이터를 인코딩할 때 사용할 캐릭터 셋을 지정하기 때문
                        - GET 메소드로 파라미터를 전송시 요청 라인에 URL과 함께 쿼리 스트링으로 파라미터를 전달하여 적용 대상이 아님
                - **톰켓8 에서 디코딩시 캐릭터 셋은 utf-8이 기본값** → 인코딩이 utf-8로 되어있으면 문제가 발생하지 않음
                    - 다른 캐릭터 셋으로 디코딩하기 위해서 설정 파일에 `useBodyEncodingForURL=true` 속성을 추가해주면 GET 메소드에서도 `**request.setCharacterEncoding()` 사용가능**

### **Response 기본 객체**

- 웹서버가 웹브라우저에게 보내는 응답 정보
- 기능
 - 응답 정보에 헤더를 추가하는 기능 제공
 - 리다이렉트 기능 제공
**웹 브라우저에서의 캐시**
        
 - 캐시 : 동일한 데이터를 중복해서 로딩하지 않도록 할 때 사용
 - 웹 브라우저는 첫 번째 요청시 응답 결과를 로컬 pc의 임시 저장소인 캐시 저장소에 저장
 - 그 후, 동일한 url에 대한 요청이 있으면 WAS에 접근하지 않고, 로컬 PC의 캐시에 저장된 응답 결과를 사용
            
 - **장점**
   - 변경이 발생하지 않는 JSP응답 결과, 이미지, 정적인 HTML을 캐시에 보관하여 웹 브라우저의 응답속도를 향상시킬 수 있음
        
### **웹 브라우저 캐시 제어를 위한 응답 헤더 입력**
        
  - 게시판과 같이 내용이 자주 바뀌는 사이트는 웹 브라우저 캐시가 적용되면 사용자가 변경된 내용을 확인하지 못하는 **문제점 발생**
  - 따라서 **다음과 같이 응답 헤더를 추가하여 웹 브라우저에 캐시가 저장되지 않도록 설정**할 필요가 있음
            
             ```java
             Cache-Control : no-cache -> HTTP 1.1 버전에서 지원하는 헤더, no-cache로 지정시 웹 브라우저는 응답결과를 캐시하지 않음
             Cache-Control : no-store -> no-chache로 설정해도 응답 내용을 캐시 저장소에 보관할 수 있음 -> 응답 결과가 캐시 저장소 자체에 보관되지 않도록 no-store 설정
             Pragma : no-cache -> HTTP 1.0 지원 헤더, no-cache로 지정시 웹 브라우저는 응답 결과를 캐시에 저장하지 않음
             Expires : 1 -> HTTP 1.0 지원 헤더, 응답 결과의 만료일을 지정, 만료일을 현재 시간보다 이전으로 설정하여 캐시에 보관되지 않도록 함
             ```
            
             - HTTP 1.1 버전을 최근 브라우저는 지원하지만 HTTP 1.0버전을 지원하는 웹 브라우저가 존재할 수 있어 Cache-Control 응답 헤더와 Pragma, Expires 응답 헤더를 모두 설정
            

## **리다이렉트를 이용해서 페이지 이동**
        
![KakaoTalk_20230729_211939985.jpg](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/266a96a8-4e07-4446-889b-82932ca14b06/KakaoTalk_20230729_211939985.jpg)
        
- response시 리다이렉트 지정 시 지정된 url로 리다이렉트하기 위해 웹브라우저가 웹서버에 해당 url 요청하는 방식으로 동작
 - `response.sendRedirect(String location)`
    - 웹 브라우저가 리다이렉트 하도록 지시
    - 리다이렉트하는 경우에 **인코딩된 쿼리 스트링을 사용**하여야 함
     - `/chap03/index.jsp?name=%EC#SD%DFESF` → 인코딩된 쿼리 스트링
     - 인코딩시 `URLEncoder.encode()` 메소드를 사용하여 값을 지정한 캐릭터 셋으로 인코딩