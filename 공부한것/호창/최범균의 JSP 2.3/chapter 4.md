# CHAPTER4 필수 이해 요소

## JSP 처리 과정과 출력버퍼

### **JSP 처리 과정**
![KakaoTalk_20230730_235211459](https://github.com/HoChangSUNG/mentoring/assets/76422685/f9f32d35-cff9-4434-b7c6-f569d02c99c2)
- **JSP에 해당 서블릿이 존재하지 않는 경우(1.1)**
    - 변환 단계(1.2) → 컴파일 단계(1.3) → 서블릿에 요청 전달(2.1) → 처리 결과를 응답으로 생성(2.2) → 응답 전송(3)
- **JSP에 해당 서블릿이 존재하는 경우**
    - 서블릿에 요청 전달(2.1) → 처리 결과를 응답으로 생성(2.2)→ 응답 전송(3)

- **즉, JSP 페이지를 요청할 때** JSP 페이지를 직접 실행하는 것이 아니라 **JSP를 자바코드로 변환하고 컴파일하여 생성한 서블릿을 실행**하는 것

**변환 단계** : JSP 페이지를 자바 코드로 변경하는 단계

**컴파일 단계** : 자바코드를 서블릿 클래스로 변경하는 단계

### **출력 버퍼**

- JSP 페이지가 생성하는 출력 내용을 저장했다가 한번에 웹 브라우저로 전송
- **동작 방식**
    ![KakaoTalk_20230730_235251550](https://github.com/HoChangSUNG/mentoring/assets/76422685/a708ac91-0305-4c6d-81f8-1c78aa4a1048)
    
    1. JSP 페이지가 생성하는 출력 내용을 버퍼에 저장
    2. 버퍼가 차면 **플러시**
        - **플러시** : 버퍼가 다 찼을 때 버퍼에 쌓인 데이터를 전송하고, 버퍼를 비우는 것
    3. 버퍼에 데이터 적재 
- **장점**
    - 데이터 전송 성능 향상
        - 한번에 큰 단위로 데이터를 전송하기 때문에 전송 성능 향상
    - JSP 도중 버퍼를 비우고 새로운 내용 전송 가능(에러 페이지 처리 기능,forward 기능)
        - 에러 페이지 처리 기능 : jsp 실행 과정에서 에러 발생 시 지금까지 쌓인 버퍼의 데이터를 지우고 에러 화면 출력
        - forward 기능 : 버퍼의 내용을 지우고, forward된 jsp 페이지를 실행하여 버퍼에 내용을 채우는 것이 가능
    - 버퍼가 다 차기 전까지 헤더 변경 가능
        - was가 처음 버퍼의 내용을 웹 브라우저에 전송하기 전에 헤더 정보를 전송하기 때문에 버퍼가 다 차서 웹 브라우저에 버퍼 내용을 전송하기 전까지는 헤더 정보 변경 가능
        - but, 버퍼 내용이 웹 브라우저에 전송되면 그 이후에는 헤더 정보 변경해도 적용 안됨
        

### **page 디렉티브에서의 버퍼 설정(buffer 속성, autoFlush 속성)**

- page 디렉티브의 buffer 속성
    - JSP 페이지가 사용할 버퍼의 크기 지정할 때 사용
    - page 디렉티브의 buffer 속성을 사용하지 않을 경우
        - `<%@ page buffer = “none”%>` → buffer 사용을 하지 않음
        - **버퍼 사용 하지 않을 경우 제한되는 기능**
            - forward 기능 사용 불가능
            - 곧바로 전송되어 출력한 내용 취소 불가능

- page 디렉티브의 autoFlush 속성
    - true : 버퍼가 다 차면 플러시하고 계속해서 작업 진행
    - false :  버퍼가 다 차면 Exception 발생시키고 작업 중
    

## 웹 어플리케이션 폴더 구조와 URL 매핑

### 웹 어플리케이션 폴더

- 웹 어플리케이션이 위치하는 폴더 의미
- webapps디렉터리에 위치한 폴더(ROOT 등)가 해당
    - ROOT 폴더 : 루트 웹 어플리케이션을 위한 특수 폴더
- **웹 어플리케이션 폴더 구조**
    
    ```java
    웹 어플리케이션(ROOT 폴더 등)
    |--WEB-INF
    		|--classes
    		|--lib
    ```
    
    - WEB-INF : 웹 어플리케이션 설정 정보를 담고 있는 web.xml 위치
    - WEB-INF/classes : 웹 어플리케이션에서 사용하는 클래스 파일 위치
    - WEB-INF/lib : 웹 어플리케이션에서 사용하는 jar 파일 위치
    - 그 이외 : 웹 어플리케이션에서 사용할 JSP, HTML, 이미지 등 위치
    

### 웹 어플리케이션 폴더와 URL 관계

- `[톰켓]\webapps\[웹 경로] → http://host:port[/웹 경로]`
    
    ```java
    webapps\chap02 → http://localhost:8080/chap02
    webapps\chap04 → http://localhost:8080/chap04
    webapps\ROOT → http://localhost:8080
    ```
    
    - URL의 첫번째 경로와 일치하는 컨텍스트 경로(context path)를 가진 웹 어플리케이션이 존재하지 않으면, 루트 웹 어플리케이션이 요청 처리
        - **컨텍스트 경로(context path)** : 웹어플리케이션을 구분하기 위한 path
    - 즉, URL에 맞는 웹 어플리케이션이 요청을 처리
    

### 웹 어플리케이션 배포

- 방식
    - 대상 폴더에 파일을 직접 복사
        - 톰켓 서버의 특정 폴더에 파일을 직접 복사하는 방식
    - war 파일로 묶어서 배포
        - jar 명령어를 이용해 war 파일로 묶고, 실 서버의 webapps 폴더에 복사
        - war : 웹 어플리케이션 구성 요소를 하나로 묶어 놓은 파일(Web Application Archive)
