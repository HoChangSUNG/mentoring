
### 라우터

- 데이터의 목적지가 어느 네트워크에 접속되어 있는지를 판단해 다음 라우터로 전송(**라우팅**)한다
- 네트워크끼리 서로 연결
- 전송할 대상이 되는 데이터는 IP 패킷
- 라우터가 IP 패킷 전송 시, IP 헤더의 TTL과 헤더 체크섬만 변경(NAT가 이루어질 때는 IP 주소도 변경), 네트워크 인터페이스층 프로토콜 헤더는 라우터가 전송할 때 완전히 새로운 헤더로 교체
- **동작 원리**
    1. IP 패킷을 수신
    2. 라우팅 테이블 상의 경로 정보를 검색해 전송할 곳을 결정(**넥스트 홉**=다음에 전송할 라우터)
    3. 넥스트 홉으로 전송하기 위해 이더넷 헤더를 추가해야 하므로 넥스트 홉의 MAC 주소를 구하기 위해 ARP 실행 → 새로운 이더넷 헤더로 교체 → 넥스트 홉으로 데이터 전달
        - 출발지 MAC 주소 : 현재 라우터 MAC 주소
        - 목적지 MAC 주소 : 넥스트 홉 MAC 주소
        - IP 헤더의 출발지, 목적지 IP 주소는 동일, but IP 헤더의 TTL을 -1 하고 헤더 체크섬을 다시 계산
    4. 라우팅 처리는 라우터마다 수행하고, 최종 목적지에 직접 접속된 라우터까지 IP 패킷이 전송
    5. 마지막 라우터는 IP 패킷의 목적지 IP 주소의 MAC 주소를 ARP로 질의해 IP 패킷을 전송 
    

### **라우팅 테이블**

- 어떤 네트워크로 IP 패킷을 전송하려면 다음에 어느 라우터로 전송해야 하는지 경로 등록
- 경로 정보 : 라우팅 테이블에 등록된 네트워크 정보
    - **네트워크주소/서브넷마스크와 넥스트 홉 주소**가 저장
- `네트워크 주소 : 넥스트 홉` 으로 구성
- 네트워크 주소 → 목적지 IP 주소, 넥스트 홉 → 동일 네트워크에 존재하는 라우터 IP주소
- 경로 요약 : 넥스트 홉이 공통인 원격 네트워크의 경로 정보를 하나로 모아 등록
- 디폴트 경로
    - 0.0.0.0/0 으로 나타내는 모든 네트워크를 집약한 궁극의 집약 경로
    - 인터넷으로 라우팅하기 위한 경로 정보로서 디폴트 경로를 이용하는 경우가 많음

### 라우팅 테이블 경로 정보 등록 방법

1. **직접 접속** : 라우터가 직접 연결된 네트워크의 경로 정보
2. **스태틱 라우팅** : 경로 정보를 수동으로 라우팅 테이블에 등록하는 방법
3. **라우팅 프로토콜** : 라우터끼리 정보를 교환해 라우팅 테이블에 경로 정보를 등록하는 방법 

### 레이어3 스위치

- 레이어2 스위치에 라우터 기능을 추가한 네트워크 기기
- 같은 네트워크로 데이터 전송 시 레이어 2 스위치처럼 전송(MAC 주소 기반으로 전송)
- 다른 네트워크로 데이터 전송 시 라우터처럼 전송(IP 주소를 기반으로 전송)
- VLAN 기능을 이용

### VLAN

- 레이어2 스위치에서 네트워크를 복수로 분리할 수 있게 하는 것, 레이어 2 스위치를 가상으로 네트워크를 분할하는 것
- 같은 VLAN에 할당된 포트 사이에서만 이더넷 프레임 전송 가능
- VLAN으로 분할된 레이어2 스위치끼리는 연결되어 있지 않으므로, VLAN이 다르면 통신이 불가능
    
    → VLAN으로 분할한 네트워크가 서로 통신하기 위해 라우터 또는 레이어3 스위치 이용
    
    ![KakaoTalk_20230907_112258190](https://github.com/HoChangSUNG/mentoring/assets/76422685/263d9eb0-7e2e-4ea6-a697-539971f192f4)


### 태그 VLAN

- 포트를 VLAN별로 가상으로 분할
- 태그 VLAN 포트
    - 복수의 레이어 2 스위치로 VLAN을 구성할 때 스위치 간의 접속을 연결하는 포트 (하나의 포트를 VLAN별로 분할해서 사용할 수 있게 해줌)
    - 복수의 VLAN에 할당되어, 복수의 VLAN 이더넷 프레임을 전송할 수 있는 포트
        - 태그 VLAN 포트로 송수신하는 이더넷 프레임에는 VLAN 태그가 추가됨
            
            → 레이어 2 스위치가 VLAN 태그로 VLAN 식별하고, 동일 VLAN포트끼리 이더넷 프레임 전송
            
        
        ![KakaoTalk_20230907_112258190_01](https://github.com/HoChangSUNG/mentoring/assets/76422685/1e67c052-055e-4eec-8f03-4158b640c92a)

    

### VLAN과 태그 VLAN

- VLAN : 레이어 2 스위치를 가상으로 분할
- 태그 VLAN : 포트를 VLAN별로 가상으로 분할

→ VLAN 설정에 따라 네트워크를 어떻게 분할할지 자유롭게 결정할 수 있고 유연하게 구성할 수 있음(VLAN 장점)

### VLAN간 라우팅

- VLAN을 서로 연결해서 VLAN끼리 통신할 수 있게 하는 것
- VLAN간 라우팅을 위해서는 **라우터** 또는 **레이어3 스위치**가 필요
- **레이어 3 스위치**
    - 내부에 가상 라우터 포함
    - IP 주소를 설정해서 VLAN을 연결
        - IP 주소 설정 방법 2가지
            1. 레이어3 스위치 내부의 가상 인터페이스(VLAN 인터페이스)에 IP 주소를 설정
            2. 레이어3 스위치의 포트 자체에 IP 주소를 설정
    - 레이어 3 스위치 내부
        
        ![KakaoTalk_20230907_112258190_02](https://github.com/HoChangSUNG/mentoring/assets/76422685/b0529f38-0771-45fe-8352-0598c2ae36e9)

    

### PC에도 라우팅 테이블이 있다

- PC나 서버 등 TCP/IP 사용하는 모든 기기에 라우팅 테이블이 존재
- PC에서의 라우팅 원칙은 라우터와 동일, BUT PC의 라우팅 테이블에는 너무 자세히 경로 정보를 등록하지 않고, 등록할 정보는 기본적으로 다음 두가지
    1. 직접 접속 경로 정보 : IP 주소 설정
    2. 디폴트 경로 : 기본 게이트웨이의 IP 주소 설정 → 0.0.0.0/0(디폴트 경로) : 192.168.1.254(기본 게이트웨이)
    
    → 기본 게이트웨이 IP 주소를 설정하여 PC의 라우팅 테이블의 모든 네트워크를 집약한 디폴트 경로가 등록됨
  ![KakaoTalk_20230907_112258190_03](https://github.com/HoChangSUNG/mentoring/assets/76422685/17369a92-cc00-4634-a525-18664f45c9c0)
